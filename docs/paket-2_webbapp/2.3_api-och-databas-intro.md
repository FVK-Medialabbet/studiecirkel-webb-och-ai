# 2.3 Hämta data från ett API – fetch och JSON

<p align="left">
  <img src="../assets/images/modules/p2-23-api-database.svg"
       alt="Illustration: API och dataflöde mot databas"
       width="320" />
</p>

Nu går vi vidare från data som bara finns i vår egen array till att **hämta data från ett API**.

Målet är att:

- prova på `fetch()` i JavaScript  
- läsa och förstå enkel **JSON**  
- visa data från ett API i din HTML-lista

Vi håller det på **demo-nivå** – det är okej om alla inte gör hela flödet själva första gången.

---

## Mål

Efter modulen ska du:

- veta vad **JSON** är på en grundläggande nivå  
- ha sett hur `fetch()` används för att:
  - skicka en förfrågan  
  - få ett svar  
  - göra om svaret till JavaScript-objekt/array  
- kunna visa upp några rader data från ett API på din sida

---

## JSON – kort introduktion

**JSON** (JavaScript Object Notation) är ett textformat för data.

Exempel:

```json
[
  { "name": "Promenad i Slottsskogen", "place": "Göteborg" },
  { "name": "Bordtennis", "place": "Hisingen" }
]
```

Det liknar JavaScript-objekt och arrayer, och är därför smidigt att använda i webblappar.

---

## Steg 1 – Enkel `fetch()`-demo

Börja med ett **öppet test-API** under träffen (kursledaren kan välja ett som funkar bra just då).  
Exempel-URL (endast som illustration här):

```text
https://exempel-api.test/aktiviteter
```

Lägg till i `app.js` (eller i en separat demo-fil):

```js
async function fetchActivities() {
  const response = await fetch("https://exempel-api.test/aktiviteter");
  const data = await response.json();

  console.log("Data från API:", data);
}

fetchActivities();
```

Förklara steg för steg:

- `fetch(...)` skickar en förfrågan  
- `await response.json()` gör om svaret till JavaScript-data  
- vi loggar datan i konsolen för att se hur den ser ut

Visa gärna webbläsarens **utvecklingsverktyg** (F12 → Console) så deltagarna ser utskriften.

---

## Steg 2 – Använd API-data i din lista

Anta att API:t svarar med en lista liknande den du hade lokalt, t.ex.:

```json
[
  { "name": "Promenad i Slottsskogen", "place": "Göteborg" },
  { "name": "Bordtennis", "place": "Hisingen" }
]
```

Justera `fetchActivities()` så att det fyller din befintliga `activities`-lista:

```js
let activities = []; // börja tomt

async function fetchActivities() {
  const response = await fetch("https://exempel-api.test/aktiviteter");
  const data = await response.json();

  activities = data;    // ersätt vår lista med data från API:t
  renderActivities();   // använd funktionen från 2.2
}

fetchActivities();
```

Nu:

1. Hämtas data från API:t  
2. Sparas i `activities`  
3. Sidan ritar upp listan med `renderActivities()`  

---

## Steg 3 – Kombinera med lokal tilläggning

Du kan fortfarande låta användaren lägga till extra aktiviteter lokalt med formuläret från 2.2:

- först hämtas listan från API  
- sedan kan `activities.push(...)` lägga till nya rader  
- de nya finns bara i webbläsaren (inte tillbaka i API:t) – men det räcker för **demot**

För mer avancerade appar behöver vi en **egen backend** som tar emot POST-förfrågningar och sparar data i en databas.  
Det är något vi kan titta på i ett senare paket eller i en fortsättningscirkel.

---

## Övningar / varianter

### 1. Byt API

- Kursledaren kan förbereda 1–2 olika API:n:
  - ett med “aktiviteter”
  - ett med t.ex. “användare” eller “inlägg”
- Deltagarna kan prova att:
  - byta URL  
  - anpassa `renderActivities()` så rätt fält visas

### 2. Visa mer information

- Om API:t skickar fler fält, t.ex. `description` eller `time`, lägg till i utskriften i `renderActivities()`.

### 3. Hantera fel (lite försiktigt)

Visa enkelt exempel:

```js
async function fetchActivities() {
  try {
    const response = await fetch("https://exempel-api.test/aktiviteter");
    if (!response.ok) {
      throw new Error("Något gick fel: " + response.status);
    }
    const data = await response.json();
    activities = data;
    renderActivities();
  } catch (error) {
    console.error("Kunde inte hämta aktiviteter:", error);
  }
}
```

Det viktiga här är att deltagarna **ser att fel kan uppstå** och att det är okej – vi kan hantera dem stegvis senare.

---

## Tips till kursledare

- Förbered ett API som du vet fungerar (t.ex. ett öppet test-API) och testa koden innan träffen.  
- Var tydlig med att:
  - API:er kan ändras  
  - man ibland måste läsa dokumentation eller prova sig fram  
- Om det blir för mycket på en gång för gruppen:
  - kör bara `fetch()` + `console.log(data)` som demo  
  - låt resten vara inspiration / fortsättning för de nyfikna
